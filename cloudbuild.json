{
    "substitutions": {
      "_APPNAME": "your-app-name",
      "_PROD_GKRANE_URL": "https://yourdomain.com"
    },
    "steps": [
      {
        "name": "node:20",
        "entrypoint": "bash",
        "args": [
          "-c",
          "npm install"
        ]
      },
      {
        "name": "gcr.io/cloud-builders/git",
        "entrypoint": "bash",
        "args": [
          "-c",
          "mkdir -p client"
        ]
      },
      {
        "name": "gcr.io/cloud-builders/curl",
        "entrypoint": "bash",
        "args": [
          "-c",
          "CLIENT_REPOS_JSON=$(curl -s -L \"$_PROD_GKRANE_URL/krane/get-app-data?name=$_APPNAME\") && \\
           echo \"$CLIENT_REPOS_JSON\" | jq -c '.repos.client[]' | while read -r client; do \\
             NAME=$(echo \"$client\" | jq -r '.name'); \\
             echo \"Cloning $NAME into client/$NAME\"; \\
             git clone https://github.com/genesiskrane/gk-vite \"client/$NAME\"; \\
             cd \"client/$NAME\"; \\
             npm install; \\
             npx vite build; \\
             find . -mindepth 1 ! -name 'dist' ! -path './dist/*' -exec rm -rf {} +; \\
             cd -; \\
           done"
        ]
      }
    ],
    "options": {
        "logging": "CLOUD_LOGGING_ONLY"
    },
  }