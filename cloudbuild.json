{
	"steps": [
		{
			"name": "gcr.io/google.com/cloudsdktool/cloud-sdk",
			"entrypoint": "bash",
			"args": [
				"-c",
				"set -e && \n\
  echo 'Fetching secrets...' && \n\
  NAME=$(gcloud secrets versions access latest --secret=NAME) && \n\
  API=$(gcloud secrets versions access latest --secret=API) && \n\
  echo \"Fetched NAME: $NAME\" && \n\
  echo \"Calling API: $_API/krane/get-app-data?name=$_NAME\" && \n\
  _CLIENT_REPOS_JSON=$(curl -s -L \"$_API/krane/get-app-data?name=$_NAME\") && \n\
  echo \"Response: $_CLIENT_REPOS_JSON\" && \n\
  echo \"$_CLIENT_REPOS_JSON\" | jq -c '.repos.client[]' | while read -r client; do \n\
    PROJECT_NAME=$(echo \"$client\" | jq -r '.name'); \n\
    echo \"Cloning $_PROJECT_NAME into client/$_PROJECT_NAME\"; \n\
    git clone https://github.com/genesiskrane/gk-vite \"client/$_PROJECT_NAME\"; \n\
    cd \"client/$_PROJECT_NAME\"; \n\
    npm install; \n\
    npx vite build; \n\
    find . -mindepth 1 ! -name 'dist' ! -path './dist/*' -exec rm -rf {} +; \n\
    cd -; \n\
  done"
			]
		}
	],
	"options": {
		"logging": "CLOUD_LOGGING_ONLY"
	}
}
